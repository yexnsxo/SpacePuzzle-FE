# ğŸš€ SpacePuzzle ê²½ì œ ì‹œìŠ¤í…œ ë°±ì—”ë“œ API ëª…ì„¸ì„œ

## ğŸ“‹ ëª©ì°¨
1. [ì‹œìŠ¤í…œ ê°œìš”](#ì‹œìŠ¤í…œ-ê°œìš”)
2. [ìì› ì‹œìŠ¤í…œ](#ìì›-ì‹œìŠ¤í…œ)
3. [ë³„ ë§ˆì¼ìŠ¤í†¤ ì‹œìŠ¤í…œ](#ë³„-ë§ˆì¼ìŠ¤í†¤-ì‹œìŠ¤í…œ)
4. [ì„¹í„° í•´ê¸ˆ ì‹œìŠ¤í…œ](#ì„¹í„°-í•´ê¸ˆ-ì‹œìŠ¤í…œ)
5. [API ì—”ë“œí¬ì¸íŠ¸](#api-ì—”ë“œí¬ì¸íŠ¸)
6. [ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ](#ë°ì´í„°ë² ì´ìŠ¤-ìŠ¤í‚¤ë§ˆ)
7. [êµ¬í˜„ ê°€ì´ë“œ](#êµ¬í˜„-ê°€ì´ë“œ)

---

## ğŸ¯ ì‹œìŠ¤í…œ ê°œìš”

### **3ëŒ€ í•µì‹¬ ìì›**

| ìì› | íƒ€ì… | ì´ˆê¸°ê°’ | ìš©ë„ | íŠ¹ì§• |
|------|------|--------|------|------|
| **ë³„ (Stars)** | ëˆ„ì  | 0 | ì„¹í„° í•´ê¸ˆ, ë§ˆì¼ìŠ¤í†¤ íŠ¸ë¦¬ê±° | ì†Œëª¨ ì•ˆë¨ |
| **í¬ë ˆë”§ (Credits)** | ì†Œë¹„ | 20 | ì¼ë°˜/ë ˆì–´ ì•„ì´í…œ êµ¬ë§¤ | ì†Œë¹„ í™”í |
| **ìš°ì£¼ ë¶€í’ˆ (Space Parts)** | ì†Œë¹„ | 0 | ì—í”½/ì „ì„¤ ì•„ì´í…œ êµ¬ë§¤ | í¬ê·€ í™”í |

---

## â­ ìì› ì‹œìŠ¤í…œ

### **1ï¸âƒ£ ë³„ (Stars)**

**íšë“ ë°©ë²•:**
- ìŠ¤í…Œì´ì§€ í´ë¦¬ì–´: 1~3ê°œ (ì„±ê³¼ì— ë”°ë¼)
- ì´ íšë“ ê°€ëŠ¥: 116ê°œ

**ìš©ë„:**
- ì„¹í„° í•´ê¸ˆ ì¡°ê±´
- ë§ˆì¼ìŠ¤í†¤ ë³´ìƒ íŠ¸ë¦¬ê±°

**íŠ¹ì§•:**
- âœ… ì ˆëŒ€ ê°ì†Œí•˜ì§€ ì•ŠìŒ
- âœ… í”Œë ˆì´ì–´ ì§„í–‰ë„ì˜ ì˜êµ¬ì  ì§€í‘œ

---

### **2ï¸âƒ£ í¬ë ˆë”§ (Credits)**

**ì´ˆê¸° ì§€ê¸‰:** 20ê°œ

**íšë“ ë°©ë²•:**
- ë³„ ë§ˆì¼ìŠ¤í†¤ ë³´ìƒ
- ì„¹í„° í•´ê¸ˆ ë³´ë„ˆìŠ¤

**ìš©ë„:**
- ì¼ë°˜(Common) ì•„ì´í…œ: 3~10 í¬ë ˆë”§
- ë ˆì–´(Rare) ì•„ì´í…œ: 15~40 í¬ë ˆë”§

**ìƒì  ì˜ˆì‹œ:**
```
[í¬ë ˆë”§ ìƒì ]
- ê¸°ë³¸ ì¡°ì¢…ì„: 5 C
- í˜•ê´‘ë“± ì¡°ëª…: 8 C
- í‘œì¤€ ìˆ˜ë‚©ì¥: 12 C
- ìƒ‰ìƒ ë²½ì§€: 15 C
- ê³ ê¸‰ ì†ŒíŒŒ: 30 C
```

---

### **3ï¸âƒ£ ìš°ì£¼ ë¶€í’ˆ (Space Parts)**

**ì´ˆê¸° ì§€ê¸‰:** 0ê°œ

**íšë“ ë°©ë²•:**
- ë°ì¼ë¦¬ í¼ì¦ ì™„ë£Œ: 1ê°œ (ë§¤ì¼)
- ë³„ ë§ˆì¼ìŠ¤í†¤ ë³´ìƒ: 1~10ê°œ

**ìš©ë„:**
- ì—í”½(Epic) ì•„ì´í…œ: 3~10 ìš°ì£¼ ë¶€í’ˆ
- ì „ì„¤(Legendary) ì•„ì´í…œ: 15~25 ìš°ì£¼ ë¶€í’ˆ

**ìƒì  ì˜ˆì‹œ:**
```
[ìš°ì£¼ ë¶€í’ˆ ìƒì ]
ì—í”½:
- ì‹ë¬¼ ì¬ë°°ê¸°: 5 P
- AI ë¡œë´‡ íŒ”: 7 P
- ë„¤ì˜¨ ì‚¬ì¸: 10 P

ì „ì„¤:
- ë¬´ì¤‘ë ¥ ì¡°ì¢…ì„: 20 P
- í™€ë¡œê·¸ë¨ ì§€êµ¬ë³¸: 18 P
- ì€í•˜ìˆ˜ ë°°ê²½ ì°½ë¬¸: 25 P
```

---

## ğŸ ë³„ ë§ˆì¼ìŠ¤í†¤ ì‹œìŠ¤í…œ

### **ë§ˆì¼ìŠ¤í†¤ ë³´ìƒ í…Œì´ë¸”**

| ëˆ„ì  ë³„ | í¬ë ˆë”§ | ìš°ì£¼ ë¶€í’ˆ | ì„¹í„° í•´ê¸ˆ | ë¹„ê³  |
|---------|--------|----------|----------|------|
| **0** | 20 | 0 | ì„¹í„° 1 (íƒœì–‘ê³„) | ì´ˆê¸° ì§€ê¸‰ |
| **5** | 10 | 1 | - | ì²« ë§ˆì¼ìŠ¤í†¤ |
| **10** | 10 | 1 | - | |
| **15** | 20 | 2 | **ì„¹í„° 2 (ì™¸ê³„ í–‰ì„±)** | ì²« ì„¹í„° í•´ê¸ˆ |
| **20** | 15 | 1 | - | |
| **28** | 25 | 3 | **ì„¹í„° 3 (ì„±ìš´)** | ì¤‘ê¸‰ ë‹¨ê³„ |
| **35** | 15 | 2 | - | |
| **45** | 30 | 4 | **ì„¹í„° 4 (ì€í•˜)** | ê³ ê¸‰ ë‹¨ê³„ |
| **55** | 20 | 3 | - | |
| **65** | 40 | 5 | **ì„¹í„° 5 (ì‹¬ì—°)** | ìµœì¢… ì„¹í„° |
| **85** | 50 | 5 | - | ë§ˆìŠ¤í„° ë‹¨ê³„ |
| **105** | 60 | 8 | - | ì „ì„¤ ìˆ˜ì§‘ê°€ |
| **116** | 100 | 10 | - | ì¡¸ì—… ë³´ìƒ |

**ì´ ë³´ìƒ:**
- í¬ë ˆë”§: 315ê°œ
- ìš°ì£¼ ë¶€í’ˆ: 45ê°œ

---

## ğŸšª ì„¹í„° í•´ê¸ˆ ì‹œìŠ¤í…œ

### **ì„¹í„° ì •ë³´**

| ì„¹í„° ID | ì„¹í„° ì´ë¦„ | í•„ìš” ë³„ | í•´ê¸ˆ ë³´ë„ˆìŠ¤ | í…Œë§ˆ |
|---------|----------|---------|------------|------|
| 1 | íƒœì–‘ê³„ (Solar System) | 0 | - | ê¸°ë³¸ |
| 2 | ì™¸ê³„ í–‰ì„± (Exoplanets) | 15 | 20C + 2P | ë¯¸ì§€ì˜ ì„¸ê³„ |
| 3 | ì„±ìš´ (Nebula) | 28 | 25C + 3P | í™”ë ¤í•œ ê°€ìŠ¤ êµ¬ë¦„ |
| 4 | ì€í•˜ (Galaxy) | 45 | 30C + 4P | ê±°ëŒ€í•œ ìš°ì£¼ |
| 5 | ì‹¬ì—° (Deep Space) | 65 | 40C + 5P | ë¸”ë™í™€ê³¼ ì•”í‘ ë¬¼ì§ˆ |

---

## ğŸ”Œ API ì—”ë“œí¬ì¸íŠ¸

### **1ï¸âƒ£ ìœ ì € ìì› ì¡°íšŒ**

#### **ì—”ë“œí¬ì¸íŠ¸:**
```
GET /user/resources
```

#### **í—¤ë”:**
```javascript
{
  "Authorization": "Bearer {access_token}"
}
```

#### **ì‘ë‹µ (200 OK):**
```json
{
  "stars": 25,
  "credits": 45,
  "spaceParts": 3,
  "unlockedSectors": [1, 2]
}
```

---

### **2ï¸âƒ£ ìŠ¤í…Œì´ì§€ ì™„ë£Œ**

#### **ì—Œë“œí¬ì¸íŠ¸:**
```
POST /stages/complete
```

#### **í—¤ë”:**
```javascript
{
  "Authorization": "Bearer {access_token}",
  "Content-Type": "application/json"
}
```

#### **ìš”ì²­ ë°”ë””:**
```json
{
  "stageId": "earth_stage_1",
  "sectorId": 1,
  "playTime": 120,
  "starsEarned": 3
}
```

#### **ì‘ë‹µ (200 OK):**
```json
{
  "success": true,
  "newTotalStars": 28,
  "credits": 45,
  "spaceParts": 3,
  "milestoneRewards": {
    "triggered": true,
    "milestone": 28,
    "creditsEarned": 25,
    "spacePartsEarned": 3,
    "sectorUnlocked": {
      "id": 3,
      "name": "ì„±ìš´"
    }
  },
  "newUnlockedSectors": [1, 2, 3]
}
```

**í•„ë“œ ì„¤ëª…:**
- `starsEarned`: ì´ë²ˆ í´ë¦¬ì–´ë¡œ íšë“í•œ ë³„ (1~3)
- `newTotalStars`: ëˆ„ì  ë³„ ê°œìˆ˜
- `milestoneRewards.triggered`: ë§ˆì¼ìŠ¤í†¤ ë‹¬ì„± ì—¬ë¶€
- `sectorUnlocked`: ìƒˆë¡œ í•´ê¸ˆëœ ì„¹í„° (ì—†ìœ¼ë©´ null)

---

### **3ï¸âƒ£ ë°ì¼ë¦¬ í¼ì¦ ì™„ë£Œ**

#### **ì—”ë“œí¬ì¸íŠ¸:**
```
POST /daily-puzzle/complete
```

#### **í—¤ë”:**
```javascript
{
  "Authorization": "Bearer {access_token}",
  "Content-Type": "application/json"
}
```

#### **ìš”ì²­ ë°”ë””:**
```json
{
  "puzzleDate": "2026-01-19",
  "playTime": 180
}
```

#### **ì‘ë‹µ (200 OK):**
```json
{
  "success": true,
  "spacePartsEarned": 1,
  "newTotalSpaceParts": 4,
  "message": "ì˜¤ëŠ˜ì˜ í¼ì¦ ì™„ë£Œ! ìš°ì£¼ ë¶€í’ˆ 1ê°œ íšë“!"
}
```

#### **ì—ëŸ¬ ì‘ë‹µ (400 Bad Request):**
```json
{
  "success": false,
  "message": "Already completed today's puzzle"
}
```

---

### **4ï¸âƒ£ ë§ˆì¼ìŠ¤í†¤ ë³´ìƒ ì¡°íšŒ**

#### **ì—”ë“œí¬ì¸íŠ¸:**
```
GET /milestones
```

#### **ì‘ë‹µ (200 OK):**
```json
{
  "milestones": [
    {
      "requiredStars": 5,
      "credits": 10,
      "spaceParts": 1,
      "sectorUnlock": null,
      "achieved": true
    },
    {
      "requiredStars": 15,
      "credits": 20,
      "spaceParts": 2,
      "sectorUnlock": {
        "id": 2,
        "name": "ì™¸ê³„ í–‰ì„±"
      },
      "achieved": true
    },
    {
      "requiredStars": 28,
      "credits": 25,
      "spaceParts": 3,
      "sectorUnlock": {
        "id": 3,
        "name": "ì„±ìš´"
      },
      "achieved": false
    }
  ],
  "nextMilestone": {
    "requiredStars": 28,
    "starsNeeded": 3
  }
}
```

---

### **5ï¸âƒ£ ì„¹í„° ì •ë³´ ì¡°íšŒ**

#### **ì—”ë“œí¬ì¸íŠ¸:**
```
GET /sectors
```

#### **í—¤ë”:**
```javascript
{
  "Authorization": "Bearer {access_token}"
}
```

#### **ì‘ë‹µ (200 OK):**
```json
{
  "sectors": [
    {
      "id": 1,
      "name": "íƒœì–‘ê³„",
      "nameEn": "Solar System",
      "requiredStars": 0,
      "unlocked": true,
      "stages": [
        {
          "id": "earth",
          "name": "ì§€êµ¬",
          "difficulty": "ì‰¬ì›€",
          "gridSize": 3,
          "completed": true,
          "stars": 3
        }
      ]
    },
    {
      "id": 2,
      "name": "ì™¸ê³„ í–‰ì„±",
      "nameEn": "Exoplanets",
      "requiredStars": 15,
      "unlocked": true,
      "unlockBonus": {
        "credits": 20,
        "spaceParts": 2
      },
      "stages": []
    },
    {
      "id": 3,
      "name": "ì„±ìš´",
      "nameEn": "Nebula",
      "requiredStars": 28,
      "unlocked": false,
      "unlockBonus": {
        "credits": 25,
        "spaceParts": 3
      },
      "stages": []
    }
  ],
  "currentStars": 25
}
```

---

### **6ï¸âƒ£ ìƒì  ì•„ì´í…œ êµ¬ë§¤**

#### **ì—”ë“œí¬ì¸íŠ¸:**
```
POST /shop/purchase
```

#### **í—¤ë”:**
```javascript
{
  "Authorization": "Bearer {access_token}",
  "Content-Type": "application/json"
}
```

#### **ìš”ì²­ ë°”ë””:**
```json
{
  "itemId": "epic_plant_grower",
  "itemName": "ì‹ë¬¼ ì¬ë°°ê¸°",
  "itemCategory": "item",
  "itemRarity": "epic",
  "priceType": "spaceParts",
  "priceAmount": 5
}
```

**í•„ë“œ ì„¤ëª…:**
- `priceType`: "credits" ë˜ëŠ” "spaceParts"
- `itemRarity`: "common", "rare", "epic", "legendary"

#### **ì‘ë‹µ (200 OK):**
```json
{
  "success": true,
  "remainingCredits": 45,
  "remainingSpaceParts": 2,
  "message": "ì‹ë¬¼ ì¬ë°°ê¸° êµ¬ë§¤ ì™„ë£Œ!"
}
```

#### **ì—ëŸ¬ ì‘ë‹µ (400 Bad Request):**
```json
{
  "success": false,
  "message": "Insufficient space parts" // ë˜ëŠ” "Insufficient credits"
}
```

---

## ğŸ’¾ ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### **1ï¸âƒ£ users í…Œì´ë¸” (ì—…ë°ì´íŠ¸)**

```sql
CREATE TABLE users (
  id VARCHAR(255) PRIMARY KEY,
  email VARCHAR(255) UNIQUE NOT NULL,
  nickname VARCHAR(50),
  
  -- ìì›
  total_stars INTEGER DEFAULT 0,          -- ëˆ„ì  ë³„ (ì ˆëŒ€ ê°ì†Œ ì•ˆ í•¨)
  credits INTEGER DEFAULT 20,              -- í¬ë ˆë”§ (ì´ˆê¸° 20ê°œ)
  space_parts INTEGER DEFAULT 0,           -- ìš°ì£¼ ë¶€í’ˆ (ì´ˆê¸° 0ê°œ)
  
  -- ë©”íƒ€ ì •ë³´
  tutorial_completed BOOLEAN DEFAULT FALSE,
  last_daily_puzzle_date DATE,            -- ë§ˆì§€ë§‰ ë°ì¼ë¦¬ í¼ì¦ ë‚ ì§œ
  
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE INDEX idx_users_stars ON users(total_stars);
```

---

### **2ï¸âƒ£ milestones í…Œì´ë¸” (ë§ˆìŠ¤í„° ë°ì´í„°)**

```sql
CREATE TABLE milestones (
  id SERIAL PRIMARY KEY,
  required_stars INTEGER NOT NULL UNIQUE,
  reward_credits INTEGER DEFAULT 0,
  reward_space_parts INTEGER DEFAULT 0,
  unlocks_sector_id INTEGER,              -- NULLì´ë©´ ì„¹í„° í•´ê¸ˆ ì—†ìŒ
  milestone_order INTEGER NOT NULL
);

-- ì´ˆê¸° ë°ì´í„° ì‚½ì…
INSERT INTO milestones (required_stars, reward_credits, reward_space_parts, unlocks_sector_id, milestone_order) VALUES
(5, 10, 1, NULL, 1),
(10, 10, 1, NULL, 2),
(15, 20, 2, 2, 3),
(20, 15, 1, NULL, 4),
(28, 25, 3, 3, 5),
(35, 15, 2, NULL, 6),
(45, 30, 4, 4, 7),
(55, 20, 3, NULL, 8),
(65, 40, 5, 5, 9),
(85, 50, 5, NULL, 10),
(105, 60, 8, NULL, 11),
(116, 100, 10, NULL, 12);
```

---

### **3ï¸âƒ£ user_milestones í…Œì´ë¸”**

```sql
CREATE TABLE user_milestones (
  id SERIAL PRIMARY KEY,
  user_id VARCHAR(255) NOT NULL,
  milestone_id INTEGER NOT NULL,
  achieved_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  FOREIGN KEY (user_id) REFERENCES users(id),
  FOREIGN KEY (milestone_id) REFERENCES milestones(id),
  UNIQUE(user_id, milestone_id)
);

CREATE INDEX idx_user_milestones_user ON user_milestones(user_id);
```

---

### **4ï¸âƒ£ sectors í…Œì´ë¸” (ë§ˆìŠ¤í„° ë°ì´í„°)**

```sql
CREATE TABLE sectors (
  id INTEGER PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  name_en VARCHAR(100) NOT NULL,
  required_stars INTEGER NOT NULL,
  unlock_bonus_credits INTEGER DEFAULT 0,
  unlock_bonus_space_parts INTEGER DEFAULT 0,
  sector_order INTEGER NOT NULL
);

-- ì´ˆê¸° ë°ì´í„° ì‚½ì…
INSERT INTO sectors (id, name, name_en, required_stars, unlock_bonus_credits, unlock_bonus_space_parts, sector_order) VALUES
(1, 'íƒœì–‘ê³„', 'Solar System', 0, 0, 0, 1),
(2, 'ì™¸ê³„ í–‰ì„±', 'Exoplanets', 15, 20, 2, 2),
(3, 'ì„±ìš´', 'Nebula', 28, 25, 3, 3),
(4, 'ì€í•˜', 'Galaxy', 45, 30, 4, 4),
(5, 'ì‹¬ì—°', 'Deep Space', 65, 40, 5, 5);
```

---

### **5ï¸âƒ£ user_sectors í…Œì´ë¸”**

```sql
CREATE TABLE user_sectors (
  id SERIAL PRIMARY KEY,
  user_id VARCHAR(255) NOT NULL,
  sector_id INTEGER NOT NULL,
  unlocked_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  FOREIGN KEY (user_id) REFERENCES users(id),
  FOREIGN KEY (sector_id) REFERENCES sectors(id),
  UNIQUE(user_id, sector_id)
);

CREATE INDEX idx_user_sectors_user ON user_sectors(user_id);
```

---

### **6ï¸âƒ£ stage_completions í…Œì´ë¸”**

```sql
CREATE TABLE stage_completions (
  id SERIAL PRIMARY KEY,
  user_id VARCHAR(255) NOT NULL,
  stage_id VARCHAR(100) NOT NULL,
  sector_id INTEGER NOT NULL,
  stars_earned INTEGER NOT NULL CHECK (stars_earned BETWEEN 1 AND 3),
  play_time INTEGER NOT NULL,
  completed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  FOREIGN KEY (user_id) REFERENCES users(id),
  FOREIGN KEY (sector_id) REFERENCES sectors(id)
);

CREATE INDEX idx_stage_completions_user ON stage_completions(user_id);
CREATE INDEX idx_stage_completions_stage ON stage_completions(stage_id);
```

---

### **7ï¸âƒ£ daily_puzzle_completions í…Œì´ë¸”**

```sql
CREATE TABLE daily_puzzle_completions (
  id SERIAL PRIMARY KEY,
  user_id VARCHAR(255) NOT NULL,
  puzzle_date DATE NOT NULL,
  play_time INTEGER NOT NULL,
  space_parts_earned INTEGER DEFAULT 1,
  completed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  FOREIGN KEY (user_id) REFERENCES users(id),
  UNIQUE(user_id, puzzle_date)
);

CREATE INDEX idx_daily_puzzle_user ON daily_puzzle_completions(user_id);
CREATE INDEX idx_daily_puzzle_date ON daily_puzzle_completions(puzzle_date);
```

---

### **8ï¸âƒ£ shop_items í…Œì´ë¸” (ë§ˆìŠ¤í„° ë°ì´í„°)**

```sql
CREATE TABLE shop_items (
  id VARCHAR(100) PRIMARY KEY,
  name VARCHAR(200) NOT NULL,
  description TEXT,
  category VARCHAR(50) NOT NULL,         -- 'background', 'item', 'cockpit'
  item_type VARCHAR(50) NOT NULL,        -- 'background', 'placeable', 'cockpit'
  rarity VARCHAR(50) NOT NULL,           -- 'common', 'rare', 'epic', 'legendary'
  price_type VARCHAR(50) NOT NULL,       -- 'credits' or 'spaceParts'
  price_amount INTEGER NOT NULL,
  icon_emoji VARCHAR(10)
);

-- ì˜ˆì‹œ ë°ì´í„°
INSERT INTO shop_items VALUES
-- í¬ë ˆë”§ ìƒì  (Common/Rare)
('basic_cockpit', 'ê¸°ë³¸ ì¡°ì¢…ì„', 'í‘œì¤€í˜• ì¡°ì¢…ì„', 'cockpit', 'cockpit', 'common', 'credits', 5, 'ğŸ•¹ï¸'),
('fluorescent_light', 'í˜•ê´‘ë“± ì¡°ëª…', 'ë°ì€ ì¡°ëª…', 'item', 'placeable', 'common', 'credits', 8, 'ğŸ’¡'),
('standard_cabinet', 'í‘œì¤€ ìˆ˜ë‚©ì¥', 'ê¸°ë³¸ ìˆ˜ë‚©ì¥', 'item', 'placeable', 'common', 'credits', 12, 'ğŸ—„ï¸'),
('color_wallpaper', 'ìƒ‰ìƒ ë²½ì§€', 'ë‹¤ì–‘í•œ ìƒ‰ìƒ', 'background', 'background', 'rare', 'credits', 15, 'ğŸ¨'),
('luxury_sofa', 'ê³ ê¸‰ ì†ŒíŒŒ', 'í¸ì•ˆí•œ ì†ŒíŒŒ', 'item', 'placeable', 'rare', 'credits', 30, 'ğŸ›‹ï¸'),

-- ìš°ì£¼ ë¶€í’ˆ ìƒì  (Epic/Legendary)
('plant_grower', 'ì‹ë¬¼ ì¬ë°°ê¸°', 'ìš°ì£¼ì—ì„œ ì‹ë¬¼ ì¬ë°°', 'item', 'placeable', 'epic', 'spaceParts', 5, 'ğŸŒ¿'),
('ai_robot_arm', 'AI ë¡œë´‡ íŒ”', 'ìë™í™” ë¡œë´‡', 'item', 'placeable', 'epic', 'spaceParts', 7, 'ğŸ¤–'),
('neon_sign', 'ë„¤ì˜¨ ì‚¬ì¸', 'í™”ë ¤í•œ ë„¤ì˜¨', 'item', 'placeable', 'epic', 'spaceParts', 10, 'ğŸ’«'),
('zero_g_cockpit', 'ë¬´ì¤‘ë ¥ ì¡°ì¢…ì„', 'ìµœì²¨ë‹¨ ì¡°ì¢…ì„', 'cockpit', 'cockpit', 'legendary', 'spaceParts', 20, 'âš¡'),
('hologram_globe', 'í™€ë¡œê·¸ë¨ ì§€êµ¬ë³¸', '3D ì§€êµ¬', 'item', 'placeable', 'legendary', 'spaceParts', 18, 'ğŸŒ'),
('galaxy_window', 'ì€í•˜ìˆ˜ ë°°ê²½ ì°½ë¬¸', 'ìš°ì£¼ ë·°', 'background', 'background', 'legendary', 'spaceParts', 25, 'ğŸŒŒ');
```

---

### **9ï¸âƒ£ shop_purchases í…Œì´ë¸” (ê¸°ì¡´ ì—…ë°ì´íŠ¸)**

```sql
CREATE TABLE shop_purchases (
  id SERIAL PRIMARY KEY,
  user_id VARCHAR(255) NOT NULL,
  item_id VARCHAR(100) NOT NULL,
  item_name VARCHAR(200),
  item_category VARCHAR(50),
  item_rarity VARCHAR(50),
  price_type VARCHAR(50) NOT NULL,       -- 'credits' or 'spaceParts'
  price_amount INTEGER NOT NULL,
  purchased_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  
  FOREIGN KEY (user_id) REFERENCES users(id),
  FOREIGN KEY (item_id) REFERENCES shop_items(id),
  UNIQUE(user_id, item_id)
);

CREATE INDEX idx_shop_purchases_user ON shop_purchases(user_id);
```

---

## ğŸ”§ êµ¬í˜„ ê°€ì´ë“œ

### **1. ìŠ¤í…Œì´ì§€ ì™„ë£Œ ë¡œì§**

```javascript
async function completeStage(userId, stageId, sectorId, playTime, starsEarned) {
  const client = await db.pool.connect();
  
  try {
    await client.query('BEGIN');
    
    // 1. ìœ ì € ì •ë³´ ì¡°íšŒ
    const userResult = await client.query(
      'SELECT total_stars, credits, space_parts FROM users WHERE id = $1 FOR UPDATE',
      [userId]
    );
    
    if (userResult.rows.length === 0) {
      throw new Error('User not found');
    }
    
    const user = userResult.rows[0];
    const oldStars = user.total_stars;
    const newTotalStars = oldStars + starsEarned;
    
    // 2. ìŠ¤í…Œì´ì§€ ì™„ë£Œ ê¸°ë¡
    await client.query(
      'INSERT INTO stage_completions (user_id, stage_id, sector_id, stars_earned, play_time) VALUES ($1, $2, $3, $4, $5)',
      [userId, stageId, sectorId, starsEarned, playTime]
    );
    
    // 3. ë³„ ì—…ë°ì´íŠ¸
    await client.query(
      'UPDATE users SET total_stars = $1 WHERE id = $2',
      [newTotalStars, userId]
    );
    
    // 4. ë§ˆì¼ìŠ¤í†¤ ì²´í¬ ë° ë³´ìƒ ì§€ê¸‰
    const milestoneResult = await client.query(
      `SELECT * FROM milestones 
       WHERE required_stars <= $1 
       AND required_stars > $2 
       ORDER BY required_stars ASC`,
      [newTotalStars, oldStars]
    );
    
    let totalCreditsEarned = 0;
    let totalSpacePartsEarned = 0;
    let sectorUnlocked = null;
    
    for (const milestone of milestoneResult.rows) {
      // ë§ˆì¼ìŠ¤í†¤ ë‹¬ì„± ê¸°ë¡
      await client.query(
        'INSERT INTO user_milestones (user_id, milestone_id) VALUES ($1, $2) ON CONFLICT DO NOTHING',
        [userId, milestone.id]
      );
      
      totalCreditsEarned += milestone.reward_credits;
      totalSpacePartsEarned += milestone.reward_space_parts;
      
      // ì„¹í„° í•´ê¸ˆ
      if (milestone.unlocks_sector_id) {
        await client.query(
          'INSERT INTO user_sectors (user_id, sector_id) VALUES ($1, $2) ON CONFLICT DO NOTHING',
          [userId, milestone.unlocks_sector_id]
        );
        
        // ì„¹í„° ì •ë³´ ì¡°íšŒ
        const sectorInfo = await client.query(
          'SELECT id, name, unlock_bonus_credits, unlock_bonus_space_parts FROM sectors WHERE id = $1',
          [milestone.unlocks_sector_id]
        );
        
        if (sectorInfo.rows.length > 0) {
          sectorUnlocked = sectorInfo.rows[0];
          totalCreditsEarned += sectorInfo.rows[0].unlock_bonus_credits;
          totalSpacePartsEarned += sectorInfo.rows[0].unlock_bonus_space_parts;
        }
      }
    }
    
    // 5. ìì› ì§€ê¸‰
    if (totalCreditsEarned > 0 || totalSpacePartsEarned > 0) {
      await client.query(
        'UPDATE users SET credits = credits + $1, space_parts = space_parts + $2 WHERE id = $3',
        [totalCreditsEarned, totalSpacePartsEarned, userId]
      );
    }
    
    // 6. í•´ê¸ˆëœ ì„¹í„° ëª©ë¡ ì¡°íšŒ
    const unlockedSectorsResult = await client.query(
      'SELECT sector_id FROM user_sectors WHERE user_id = $1 ORDER BY sector_id',
      [userId]
    );
    
    await client.query('COMMIT');
    
    return {
      success: true,
      newTotalStars,
      credits: user.credits + totalCreditsEarned,
      spaceParts: user.space_parts + totalSpacePartsEarned,
      milestoneRewards: {
        triggered: milestoneResult.rows.length > 0,
        creditsEarned: totalCreditsEarned,
        spacePartsEarned: totalSpacePartsEarned,
        sectorUnlocked
      },
      newUnlockedSectors: unlockedSectorsResult.rows.map(r => r.sector_id)
    };
  } catch (error) {
    await client.query('ROLLBACK');
    throw error;
  } finally {
    client.release();
  }
}
```

---

### **2. ë°ì¼ë¦¬ í¼ì¦ ì™„ë£Œ ë¡œì§**

```javascript
async function completeDailyPuzzle(userId, puzzleDate, playTime) {
  const client = await db.pool.connect();
  
  try {
    await client.query('BEGIN');
    
    // 1. ì˜¤ëŠ˜ ì´ë¯¸ ì™„ë£Œí–ˆëŠ”ì§€ ì²´í¬
    const existingCompletion = await client.query(
      'SELECT * FROM daily_puzzle_completions WHERE user_id = $1 AND puzzle_date = $2',
      [userId, puzzleDate]
    );
    
    if (existingCompletion.rows.length > 0) {
      await client.query('ROLLBACK');
      return {
        success: false,
        message: 'Already completed today\'s puzzle'
      };
    }
    
    // 2. ì™„ë£Œ ê¸°ë¡
    await client.query(
      'INSERT INTO daily_puzzle_completions (user_id, puzzle_date, play_time, space_parts_earned) VALUES ($1, $2, $3, 1)',
      [userId, puzzleDate, playTime]
    );
    
    // 3. ìš°ì£¼ ë¶€í’ˆ ì§€ê¸‰
    await client.query(
      'UPDATE users SET space_parts = space_parts + 1 WHERE id = $1',
      [userId]
    );
    
    // 4. í˜„ì¬ ìš°ì£¼ ë¶€í’ˆ ì¡°íšŒ
    const userResult = await client.query(
      'SELECT space_parts FROM users WHERE id = $1',
      [userId]
    );
    
    await client.query('COMMIT');
    
    return {
      success: true,
      spacePartsEarned: 1,
      newTotalSpaceParts: userResult.rows[0].space_parts,
      message: 'ì˜¤ëŠ˜ì˜ í¼ì¦ ì™„ë£Œ! ìš°ì£¼ ë¶€í’ˆ 1ê°œ íšë“!'
    };
  } catch (error) {
    await client.query('ROLLBACK');
    throw error;
  } finally {
    client.release();
  }
}
```

---

### **3. ìƒì  êµ¬ë§¤ ë¡œì§ (ì—…ë°ì´íŠ¸)**

```javascript
async function purchaseShopItem(userId, itemId) {
  const client = await db.pool.connect();
  
  try {
    await client.query('BEGIN');
    
    // 1. ì•„ì´í…œ ì •ë³´ ì¡°íšŒ
    const itemResult = await client.query(
      'SELECT * FROM shop_items WHERE id = $1',
      [itemId]
    );
    
    if (itemResult.rows.length === 0) {
      throw new Error('Item not found');
    }
    
    const item = itemResult.rows[0];
    
    // 2. ìœ ì € ìì› í™•ì¸
    const userResult = await client.query(
      'SELECT credits, space_parts FROM users WHERE id = $1 FOR UPDATE',
      [userId]
    );
    
    if (userResult.rows.length === 0) {
      throw new Error('User not found');
    }
    
    const user = userResult.rows[0];
    
    // 3. ì´ë¯¸ êµ¬ë§¤í–ˆëŠ”ì§€ í™•ì¸
    const existingPurchase = await client.query(
      'SELECT * FROM shop_purchases WHERE user_id = $1 AND item_id = $2',
      [userId, itemId]
    );
    
    if (existingPurchase.rows.length > 0) {
      await client.query('ROLLBACK');
      return { success: false, message: 'Item already purchased' };
    }
    
    // 4. ìì› ë¶€ì¡± í™•ì¸
    if (item.price_type === 'credits' && user.credits < item.price_amount) {
      await client.query('ROLLBACK');
      return { success: false, message: 'Insufficient credits' };
    }
    
    if (item.price_type === 'spaceParts' && user.space_parts < item.price_amount) {
      await client.query('ROLLBACK');
      return { success: false, message: 'Insufficient space parts' };
    }
    
    // 5. êµ¬ë§¤ ê¸°ë¡
    await client.query(
      `INSERT INTO shop_purchases 
       (user_id, item_id, item_name, item_category, item_rarity, price_type, price_amount) 
       VALUES ($1, $2, $3, $4, $5, $6, $7)`,
      [userId, itemId, item.name, item.category, item.rarity, item.price_type, item.price_amount]
    );
    
    // 6. ìì› ì°¨ê°
    if (item.price_type === 'credits') {
      await client.query(
        'UPDATE users SET credits = credits - $1 WHERE id = $2',
        [item.price_amount, userId]
      );
    } else {
      await client.query(
        'UPDATE users SET space_parts = space_parts - $1 WHERE id = $2',
        [item.price_amount, userId]
      );
    }
    
    // 7. ìµœì‹  ìì› ì¡°íšŒ
    const updatedUser = await client.query(
      'SELECT credits, space_parts FROM users WHERE id = $1',
      [userId]
    );
    
    await client.query('COMMIT');
    
    return {
      success: true,
      remainingCredits: updatedUser.rows[0].credits,
      remainingSpaceParts: updatedUser.rows[0].space_parts,
      message: `${item.name} êµ¬ë§¤ ì™„ë£Œ!`
    };
  } catch (error) {
    await client.query('ROLLBACK');
    throw error;
  } finally {
    client.release();
  }
}
```

---

## ğŸ“Š í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

### **ìì› ì‹œìŠ¤í…œ:**
- [ ] ì‹ ê·œ ìœ ì € ê°€ì… ì‹œ í¬ë ˆë”§ 20ê°œ, ìš°ì£¼ ë¶€í’ˆ 0ê°œ ì§€ê¸‰
- [ ] ë³„ì€ ì ˆëŒ€ ê°ì†Œí•˜ì§€ ì•ŠìŒ
- [ ] í¬ë ˆë”§ê³¼ ìš°ì£¼ ë¶€í’ˆì€ êµ¬ë§¤ ì‹œ ì •í™•íˆ ì°¨ê°ë¨

### **ë§ˆì¼ìŠ¤í†¤ ì‹œìŠ¤í…œ:**
- [ ] ë³„ 5ê°œ ë‹¬ì„± ì‹œ í¬ë ˆë”§ 10, ìš°ì£¼ ë¶€í’ˆ 1 ì§€ê¸‰
- [ ] ë³„ 15ê°œ ë‹¬ì„± ì‹œ ì„¹í„° 2 í•´ê¸ˆ + ë³´ë„ˆìŠ¤ ì§€ê¸‰
- [ ] ê°™ì€ ë§ˆì¼ìŠ¤í†¤ ì¤‘ë³µ ë‹¬ì„± ë°©ì§€
- [ ] ì—¬ëŸ¬ ë§ˆì¼ìŠ¤í†¤ ë™ì‹œ ë‹¬ì„± ì‹œ ëª¨ë“  ë³´ìƒ ì§€ê¸‰

### **ì„¹í„° í•´ê¸ˆ:**
- [ ] í•„ìš” ë³„ ê°œìˆ˜ ì¶©ì¡± ì‹œ ì„¹í„° ìë™ í•´ê¸ˆ
- [ ] ì„¹í„° í•´ê¸ˆ ë³´ë„ˆìŠ¤ ì •í™•íˆ ì§€ê¸‰
- [ ] í•´ê¸ˆëœ ì„¹í„°ëŠ” ì˜êµ¬ì ìœ¼ë¡œ ì ‘ê·¼ ê°€ëŠ¥

### **ë°ì¼ë¦¬ í¼ì¦:**
- [ ] ë§¤ì¼ í•œ ë²ˆë§Œ ì™„ë£Œ ê°€ëŠ¥
- [ ] ì™„ë£Œ ì‹œ ìš°ì£¼ ë¶€í’ˆ 1ê°œ ì •í™•íˆ ì§€ê¸‰
- [ ] ê°™ì€ ë‚ ì§œ ì¤‘ë³µ ì™„ë£Œ ë°©ì§€

### **ìƒì :**
- [ ] í¬ë ˆë”§ ìƒì ê³¼ ìš°ì£¼ ë¶€í’ˆ ìƒì  ë¶„ë¦¬
- [ ] ìì› ë¶€ì¡± ì‹œ êµ¬ë§¤ ì‹¤íŒ¨
- [ ] ê°™ì€ ì•„ì´í…œ ì¤‘ë³µ êµ¬ë§¤ ë°©ì§€
- [ ] êµ¬ë§¤ í›„ ìì› ì •í™•íˆ ì°¨ê°

---

## ğŸš€ ë°°í¬ ì „ í™•ì¸ì‚¬í•­

1. **í™˜ê²½ ë³€ìˆ˜:**
   - ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì •ë³´
   - JWT ì‹œí¬ë¦¿ í‚¤

2. **ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜:**
   ```bash
   # í…Œì´ë¸” ìƒì„±
   npm run migrate
   
   # ë§ˆìŠ¤í„° ë°ì´í„° ì‚½ì… (milestones, sectors, shop_items)
   npm run seed
   ```

3. **ì´ˆê¸° ë°ì´í„° ê²€ì¦:**
   - ë§ˆì¼ìŠ¤í†¤ 12ê°œ ì¡´ì¬
   - ì„¹í„° 5ê°œ ì¡´ì¬
   - ìƒì  ì•„ì´í…œ ì¡´ì¬

---

### **7ï¸âƒ£ ë¦¬ë”ë³´ë“œ ì¡°íšŒ**

#### **ì—”ë“œí¬ì¸íŠ¸:**
```
GET /sectors/{sectorSlug}/leaderboard
```

#### **í—¤ë”:**
```javascript
{
  "Authorization": "Bearer {access_token}"
}
```

#### **ì‘ë‹µ (200 OK):**
```json
{
  "topPlayers": [
    {
      "userId": "user123",
      "nickname": "SpaceMaster",
      "totalStars": 85,
      "completedPuzzles": 25,
      "rank": 1
    },
    {
      "userId": "user456",
      "nickname": "PuzzleKing",
      "totalStars": 72,
      "completedPuzzles": 20,
      "rank": 2
    }
  ],
  "myRank": {
    "userId": "currentUser",
    "nickname": "MyName",
    "totalStars": 45,
    "completedPuzzles": 12,
    "rank": 15
  }
}
```

**í•„ë“œ ì„¤ëª…:**
- `topPlayers`: ìƒìœ„ 5ëª…ì˜ í”Œë ˆì´ì–´ (ì„¹í„°ë³„ ì´ ë³„ ê°œìˆ˜ ê¸°ì¤€)
- `myRank`: í˜„ì¬ ì‚¬ìš©ìì˜ ìˆœìœ„ ì •ë³´
- `completedPuzzles`: í•´ë‹¹ ì„¹í„°ì—ì„œ ì™„ë£Œí•œ í¼ì¦ ê°œìˆ˜

---

### **8ï¸âƒ£ ê°¤ëŸ¬ë¦¬ ì¡°íšŒ (í´ë¦¬ì–´í•œ ì²œì²´ ëª©ë¡)**

#### **ì—”ë“œí¬ì¸íŠ¸:**
```
GET /user/gallery
```

#### **í—¤ë”:**
```javascript
{
  "Authorization": "Bearer {access_token}"
}
```

#### **ì‘ë‹µ (200 OK):**
```json
{
  "clearedCelestials": [
    {
      "id": "earth",
      "name": "ì§€êµ¬",
      "nameEn": "Earth",
      "sectorId": 1,
      "sectorName": "íƒœì–‘ê³„",
      "image": "https://example.com/earth.jpg",
      "starsEarned": 3,
      "clearedAt": "2026-01-15T10:30:00Z",
      "playTime": 180
    },
    {
      "id": "mars",
      "name": "í™”ì„±",
      "nameEn": "Mars",
      "sectorId": 1,
      "sectorName": "íƒœì–‘ê³„",
      "image": "https://example.com/mars.jpg",
      "starsEarned": 2,
      "clearedAt": "2026-01-16T14:20:00Z",
      "playTime": 240
    }
  ],
  "totalCleared": 2,
  "totalStars": 5
}
```

**í•„ë“œ ì„¤ëª…:**
- `clearedCelestials`: í´ë¦¬ì–´í•œ ëª¨ë“  ì²œì²´ ëª©ë¡ (ìµœê·¼ í´ë¦¬ì–´ ìˆœ)
- `totalCleared`: ì „ì²´ í´ë¦¬ì–´í•œ ì²œì²´ ê°œìˆ˜
- `totalStars`: í´ë¦¬ì–´ë¡œ íšë“í•œ ì´ ë³„ ê°œìˆ˜

---

## ğŸ“ ë¬¸ì˜

í”„ë¡ íŠ¸ì—”ë“œ íŒ€ì—ì„œ ì¶”ê°€ë¡œ í•„ìš”í•œ ì—”ë“œí¬ì¸íŠ¸ë‚˜ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ì•Œë ¤ì£¼ì„¸ìš”!
